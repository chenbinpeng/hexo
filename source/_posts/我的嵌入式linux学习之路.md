---
title: 我的嵌入式linux学习之路
date: 2016-12-07 22:10:46
tags: ['嵌入式','linux']
categories: 学习
---



这里主要讲述学生时代学习嵌入式linux的详细过程。它几乎贯穿了我整个的研究生生涯，为工作后从事软件开发奠定了基础。

<!--more-->

第一次听说linux是在读本科的时候，隔壁宿舍一重庆籍哥们儿在我们宿舍侃大山，随口说了那么一句：“现在谁还玩windows，都玩linux啦”。事实上，那个时候没有人玩linux，大家都在用windows，在windows下聊天，在windows下看电影，在windows下玩游戏。像我这样到大三才买电脑的人，甚至连windows都玩不转。但不知道为什么，就这么随口说的一句话却深深的印在了我的脑海里。以至于四年后当我真正接触到linux后都倍儿感亲切。

读研是真正接触linux的开始，那个时候有个师兄在搞，而我和那位师兄一起在做实验室同一个项目。项目是要做一个基于红外光的探测仪器，当时正处于预研阶段。除了做一些原理性的实验，就是学一点编程，以备开项后的不时之需。这样一来，一方面学了理论，另一方面有了验证理论的工具，一举两得。正好和我的想法吻合，并且linux开源分享的理念甚合我意，就这样开启了我的嵌入式linux之路。但有一点没有预料到的是，仅仅是被我当做工具的linux却耗费了我太多的精力，以至于理论的学习一度被中断。

我当时给自己的技术路线定的大方向是，控制理论和嵌入式linux，控制理论作为核心，嵌入式linux作为工具。先学工具，因为工具是载体。然后再用工具来演绎理论。

对于嵌入式linux的学习，我的想法是先易后难。因为之前有过单片机的经验，就先从简单的单片机开始。具体过程是这样的，先8位的单片机，再到16位，最后过渡到32位。先不上操作系统，也就是裸奔，然后极简单的小操作系统，最后到嵌入式linux操作系统。也就是说开始于8位单片机的裸奔，结束于32位片上系统的linux，工具的学习就算基本结束。接着重点开始控制理论的学习。当然，这样说有点马后炮，事实上这样的规划不是一开始就这样的，是在实际的学习过程中摸索出来的。

初生牛犊不怕虎，这句话一点不假。刚开始的时候仗着自己以前有过单片机的经验（8位的51单片机，学校的实验项目）。就认为基础已经可以了。上来就开始搞linux。记得当时我和实验室一哥们每人买了本unix环境高级编程，没事儿就抱着啃。那是一本很厚的书，分量很足，当时天真的认为，把那本书弄懂了就是linux高手了。所以尽管很艰难，热情还是很高。坚持了没多久，就发现实在是难懂，简直就是天书。结结实实的碰了一回壁。那哥们后来就放弃了linux，开始学wince，再后来学java，毕业后去做了ios的app开发。我则转战于ucos和STM32，准备由易入难，一点一点攻克。

那个时候我和师兄做的项目已经开始和一家企业合作，企业的条件更加充分。实验的场所也由实验室转到了公司。那段时间经常跑公司，除了自己的项目，也了解了公司在做的产品和技术。主要也都是检测仪器。简单的就用单片机裸奔就足够了，复杂的才上系统。一开始根着两个华科毕业的前辈熟悉一种检测汽车尾气的设备。他们两个一个负责软件，一个负责硬件。我主要是偏重软件，由于之前有点经验，很快就上手了，他们忙的时候，会帮着他们查个bug，添加个功能什么的。后来新开了一个测汞的项目，我和前辈没人负责一块，他做主控，我做人机交互。但没多久，他就辞职了。后来项目就全转到了我这儿来，我就兼职做起了公司的项目。好在项目不是很吃紧，所以我就边学边做。最后也算做出来了。

刚开始的时候，用的是16位的msp430单片机，后来换成了32位的STM32。当时已经被Linux虐过，改看嵌入式ucos了。看了一阵还是摸不着头脑，因为脑子里根本没有操作系统的概念。后来又买了本操作系统的书，结合着跟ucos一起看，才有点眉目。然后就尝试着将ucos移植到stm32上去。中间费了不少周折，但也收获颇多，真正明白了操作系统是怎么回事儿。不得不说，对于学嵌入式linux的同学来说，ucos是一个很好的切入口。邵贝贝翻译的那本书绝对是经典中的经典。我买的时候还是ucos2，封面很漂亮，很有科技感。被我翻了很多遍，纸都发黄了，现在还珍藏着。前两天在亚马逊上逛了一圈，发现已经ucos3了，不过封面换了，没有以前的炫酷。

stm32加ucos搞透了，再回过头来搞linux才渐渐有了感觉。先是熟悉linux操作系统，在电脑上装了个虚拟机。这一步是必不可少的，因为嵌入式linux程序开发大多是在linux上位机中进行的。如果对上位机linux不熟悉，将寸步难行。熟悉的内容主要包括各种命令行操作指令，vim编辑器，shell脚本编写等，当时也还专门买了一本很厚的书，没事儿就在虚拟机里敲敲命令，练练手。在此期间，虚拟机免不了会出问题，各种安装卸载，总之就是折腾。这些熟了以后，还要想办法让虚拟机上网，因为很多资料要从网上获取，比如在线安装一些工具等。还要配置服务器和windows共享文件。当时真是一头雾水，这个时候才发现网络知识是多么的重要。后来看了tcpip协议，知道了什么是网关，什么是dns，怎么配置路由器。

一切准备就绪，开始尝试着在上位机linux上写一些小程序。确切一点的说，应该叫调程序。买了一本应用程序开发的书，里面有很多例子程序，像一些文件操作，串口操作，以及网络通信等。仿照着那些例子在vim中修修改改，然后编译一下，运行运行。开始是用gcc直接编译，后来尝试写makefile，写shell脚本，进行自动编译。

再后来花了五百多刀买了套友善之臂的开发版，开始真正的嵌入式linux之旅。首先是了解怎么烧程序。什么是bootloader，什么是操作系统。然后尝试在已经一直好了的程序上面写一些小程序。比如操作个led灯了，在显示屏上显示一些数字啦等等。我印象中还做了一个温度监控系统。用stm32开发版采集一颗温度传感器的数据，转化成温度后通过串口发送至mini2440并在屏上进行显示。

再后来就研究bootloader的代码，研究系统是如何被一步步启动的。也尝试将uboot移植至自己的开发板。然后就是linux内核代码，包括它的启动流程，内存管理，任务调度等等。一开始一头扎进赵炯博士的代码注释那本书里，云山雾罩的。后来看了鸟哥的私房菜，搞明白了启动流程。又通过Linux设计与实现了解了系统的大体框架，再看起来就轻松多了。看的差不多之后开始着手写点驱动程序，理论上依据的的linux设备驱动那本书，配合着Linux开发与实践练手。不懂的时候就看看韦东山老师的教学视频，讲的特别好，我看了不止三遍。

在这期间，由于毕业论文的需要，还学了些服务器和网络相关的内容。包括tcpip协议，http协议，html，javascript，php开发语言，web服务器的搭建与配置，网络服务器模型等等。还用discuzz建了一个学术论坛，维护了一段时间，没有钱交空间的费用，就不了了之了。有了这些知识，就可以将我开发的仪器联网进行远程监控。我当时的设想是，在仪器端嵌入lwip协议栈进行联网，将采集到的原始数据送入服务器。这样就可以通过浏览器在任何地方进行访问。中间的服务器程序用于接收仪器的数据并进行处理，同时建立起浏览器和仪器的通信通路。这样做的好处就是，一方面可以进行远程监控，对于环境检测仪器我觉得这是必要的。另一方面将仪器端只负责数据采集，将其它任务放入服务器处理，方便程序的维护。最后，还可以省掉仪器上丑陋的显示屏，节约成本，并且美观。

等我毕业时，只是做了一个demo的程序，实际应用还有不少地方需要完善。那个时候我还不知道mqtt，也没有现在百度的天工开物物联网服务，对手机app也不熟。就用公司闲置的服务器作为实验平台，搭建了一个web服务器，还用epoll模型写了一个服务器程序用于和web进行交互。考虑到可能有的多连接高并发，甚至还研究了类似谷歌服务器架构的集群。用虚拟机创建了多台服务器进行了模拟。还记得当时开心的给一个结构工程师演示的情景，在电脑上敲了一个网址就可以在网页上实时看到仪器的运行状态，并可以进行控制。我告诉他如果有公网ip，就可以在世界的任何一个角落进行访问。对此我们都欣喜不已。

我告诉他，这套东西不仅可以用在仪器上，还可以用在很多你可以想象到的地方。那个时候智能家居才刚刚起步，还没有成熟的产品，或者有了，我们还不知道。于是就有了我们的大插排计划，目的是远程控制家用电器。基本是这样的，将嵌有lwip协议栈的芯片和插排合到一起，加上继电器。这样就可以将其联网，远程控制继电器的开闭来打开和切断插排的电源，间接达到控制电器的目的。

后来，一切都由于毕业后离开武汉而终止。两年以后看到市场上有类似的产品，激动不已。前不久百度上线了物联网服务，体验了一把，同样欣喜若狂。几年前我在公司服务器上要实现的就是这么个东西。那种感觉真的很美妙。

至此，嵌入式linux的学习虽然还在继续，但我的学生时代已经结束。



期间参考了不少的书，文中只提及了一小部分。有图书馆借的，有买的，有读完的，有草草翻了一下的，有有帮助的，有没帮助的。筛选书的过程也耗费了不少的精力。下面是一些对自己帮助比较大，自认为比较经典的，也是我都买了的，至今还在身边的，特别的列出来。



1. [嵌入式实时操作系统μC/OS-3](https://www.amazon.cn/gp/product/B00ADHUGM2/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00ADHUGM2&linkCode=as2&tag=cbp00-23)（我那个时候看的是μC/OS-II，现在好像已经绝版了）
2. [操作系统概念](https://www.amazon.cn/gp/product/B004OQE8BI/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B004OQE8BI&linkCode=as2&tag=cbp00-23)
3. [Linux命令、编辑器与Shell编程](https://www.amazon.cn/gp/product/B00436EY1S/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00436EY1S&linkCode=as2&tag=cbp00-23)
4. [鸟哥的Linux私房菜:基础学习篇](https://www.amazon.cn/gp/product/B003TJNO98/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B003TJNO98&linkCode=as2&tag=cbp00-23)
5. [鸟哥的Linux私房菜:服务器架设篇](https://www.amazon.cn/gp/product/B008AEI8A2/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B008AEI8A2&linkCode=as2&tag=cbp00-23)
6. [Linux程序设计](https://www.amazon.cn/gp/product/B003Q97NPC/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B003Q97NPC&linkCode=as2&tag=cbp00-23)
7. [UNIX环境高级编程](https://www.amazon.cn/gp/product/B00KMR129E/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00KMR129E&linkCode=as2&tag=cbp00-23)
8. [嵌入式Linux应用开发完全手册](https://www.amazon.cn/gp/product/B008QM1NMI/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B008QM1NMI&linkCode=as2&tag=cbp00-23)
9. [ARM体系结构与编程](https://www.amazon.cn/gp/product/B012CMT61W/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B012CMT61W&linkCode=as2&tag=cbp00-23)
10. [LINUX设备驱动程序](https://www.amazon.cn/gp/product/B001147E76/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B001147E76&linkCode=as2&tag=cbp00-23)
11. [Linux内核设计与实现](https://www.amazon.cn/gp/product/B004X3Z3D4/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B004X3Z3D4&linkCode=as2&tag=cbp00-23)
12. [Linux内核完全剖析:基于0.12内核](https://www.amazon.cn/gp/product/B001I9ZFUM/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B001I9ZFUM&linkCode=as2&tag=cbp00-23)
13. [TCP/IP详解卷1:协议](https://www.amazon.cn/gp/product/B00116OTVS/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00116OTVS&linkCode=as2&tag=cbp00-23)
14. [UNIX网络编程(卷1):套接字联网API](https://www.amazon.cn/gp/product/B011S72JB6/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B011S72JB6&linkCode=as2&tag=cbp00-23)
15. [编码:隐匿在计算机软硬件背后的语言](https://www.amazon.cn/gp/product/B009RSXIB4/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B009RSXIB4&linkCode=as2&tag=cbp00-23)
16. [只是为了好玩:Linux之父林纳斯自传](https://www.amazon.cn/gp/product/B00MB51SAI/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00MB51SAI&linkCode=as2&tag=cbp00-23)



其中，1让我有了操作系统的概念，11让我对linux的框架有了了解，15原本叫编码的奥秘，让我从逻辑电路层面了解了计算机的工作原理，这三本书都短小精悍，通俗易懂，是我特别喜欢的。2、7、10、13、14都是技术大牛写的书，理论性较强，比较严谨，虽然枯燥，值得一啃。4、8偏重实践，对于嵌入式linux开发，动手是少不了的。12是linux内核的注解，条理清晰，很详细。最后一本是我刚刚发现的，准备列入自己的书单。对于学linux的人，了解一下它的来龙去脉还是很有必要的，所以也一并列出。