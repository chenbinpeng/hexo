---
title: 线性插值与姿态控制
tags:
  - 插值
  - 姿态
categories: 算法
date: 2016-11-02 14:56:01
---




在知道飞机的当前姿态和目标姿态后，需要输出控制量使飞机到达目标位置。这一控制量该如何给，需要一定的策略。正如罗马不是一天造成的，一口吃不了个胖子，凡事儿得一步一步来。控制量的输出也一样，不是直接通过当前姿态和目标姿态给出的，因为这样会导致飞机在调整姿态的时候出现抖动，不够平滑。为了解决这一问题，需要用到插值算法。这篇文章的目标就是弄明白插值算法和其在姿态控制中的应用。



<!-- more -->



我们知道，当我们想要达成某一目标的时候，通常会将其分解为一个个的小目标。比如马拉松运动员会根据路标将赛程进行分解，国家将长期计划分解为小的五年计划等等。这样做的好处是，可以把握好事情进展的节奏。避免过急或过徐。急了会出现大跃进那样的悲剧，徐了会导致目标不能按时完成。在将飞机从当前姿态控制至目标姿态时也一样，需要将姿态差进行分割，一步一步完成，这就需要用到插值。



### 什么是插值

这里撇开教科书的概念，只结合姿态控制，不求严谨，只求能把问题说明白。

所谓插值，就是将当前姿态到目标姿态的“路径”进行分割，根据一定的策略，安插小的目标点。在进行姿态控制的时候，使飞机沿着这些小的目标一步一步到达目标位置。



### 一阶线性插值

举个小例子。如下图，设小车当前位置为0，目标位置为10。距离$S=10$，为了到达目标位置，可以分成$N$步来完成。假设$N=5$步，则每一步的大小为$\Delta{s}=\frac{S}{N}=2$。则第$n$步小车的目标位置为$s(n)=n*\Delta{s}=2n$。当$n$取$1,2,3,4,5$时，小车就分别以$2,4,6,8,10$为目标并走到最终位置。



 ![Fig1_interpolation](Fig1_interpolation.png)



在该例子中，小车的终极目标为10，插值策略为$s(n)=2n$。通过插值，将其分割为5个长度为2的小目标。这5个小目标即为插值。目标长度可以通过$N$来设置，用于控制小车的“精度”。$N$越大，分割越精细。如下图：

 ![Fig4_1_order](Fig4_1_order.png)



这是一种比较简单的一阶线性插值，在这种插值中因为每一步的大小一定，小车以恒速运动至目标点。但有时候我们希望小车更“智能”一点，随着当前位置和目标位置的距离动态调整速度，使小车运行的更平滑。这时候就需要调整插值策略，使用高阶的模型来描述。通常二阶就够用了。



### 二阶系统

二阶系统指的是使用二阶微分方程描述的系统。如RCL电路，带阻尼的运动模块等。下图即为一个典型的二阶系统。

 ![Fig2_2nd_order_system](Fig2_2nd_order_system.png)



根据力学定理，用二阶常系数线性微分方程描述如下：

$$
m\frac{d^2x}{dt^2}+d\frac{dx}{dt}+kx=0
$$

令：
$$
\omega_n=\sqrt{\frac{k}{m}}\\
\zeta=\frac{d}{d_{cr}}\\
d_{cr}=2\sqrt{km}
$$


式子变为：
$$
\frac{d^2x}{dt^2}+2\zeta\omega_n\frac{dx}{dt}+\omega_n^2x=0
$$


其中：
$$
\frac{d^2x}{dt^2}=a\\
\frac{dx}{dt}=v
$$
式子简化为：
$$
a+2\zeta\omega_nv+\omega_n^2x=0
$$


### 二阶线性插值

所谓二阶线性插值，也就是以二阶线性微分方程为运动规律，获取被插值量的中间值的过程。仍以小车为例。根据力学定理，其运动规律和阻尼模块相似。将$x$替换为位移$s$，有：
$$
a+2\zeta\omega_nv+\omega_n^2s=0
$$
现在的问题转换为，已知当前位置$s(t)$和目标位置s(N)，以上式为运动规律，如何求取下一刻的位移$s(t+1)$，直至到达s(N)。

除了上式的关系，加速度、速度和位移之间还满足如下关系：
$$
v(t)=\int_0^ta(t)dt\\
s(t)=\int_0^tv(t)dt
$$
于是，我们可以以当前位置$s(t)$和目标位置$s(N)$的差值$\Delta{s(t)}$作为位移$s$的输入，然后通过：
$$
a(t)=-2\zeta\omega_nv(t-1)-\omega_n^2\Delta{s(t)}
$$
求取加速度。再通过加速度求取速度$v(t)$，最后通过速度求取到下一个位移插值$s(t)$。用框图表示如下：

 ![Fig5_diagram](Fig5_diagram.png)



概括公式如下：

$$
\begin{align}
\Delta{s(t)}=s(N)-s(t)\\
a(t)=-2\zeta\omega_nv(t-1)-\omega_n^2\Delta{s(t-1)}\\
v(t)=v(t-1)+a(t)*\Delta{t}\\
s(t)=s(t-1)+v(t)*\Delta{t}
\end{align}
$$
令：

$$
\begin{align}
&s(0)=0\\
&a(0)=0\\
&v(0)=0\\
&\zeta=-2\\
&\omega_n=-0.1\\
&\Delta{t}=1
\end{align}
$$


式子化简为：
$$
\begin{align}
&\Delta{s(t)}=s(N)-s(t)\\
&a(t)=0.1v(t-1)+0.01\Delta{s(t-1)}\\
&v(t)=v(t-1)+a(t)\\
&s(t)=s(t-1)+v(t)\\
\end{align}
$$
将数据带入，进行递推如下：
$$
\begin{align}
&\Delta{s(0)}=10, a(1)=0.1,v(1)=0.1,s(1)=0.1\\
&\Delta{s(1)}=9.9, a(2)=0.11,v(2)=0.21,s(2)=0.31\\
&......
\end{align}
$$
可以得到如下图表。横坐标为t，纵坐标为s(t)。



 ![Fig3](Fig3.png)



从图中可以看出，插值结果为一条曲线。曲线的形状可以通过参数$\zeta$和$\omega_n$进行调整。



### 姿态控制

在飞机姿态控制中，给定目标姿态后，并不是根据当前姿态和目标姿态的差进行PID计算得出控制量进行控制。这样的话控制量会很大，导致飞机抖动。而是根据这个差进行插值，得出下一步的目标姿态，然后进行控制。等达到第一个插值的目标后，再计算下一个插值目标，如此反复，直至按照插值的路径抵达最终目标。



飞机的姿态控制，本质上类似于刚体的旋转控制，刚体旋转的二阶微分方程如下：
$$
I\frac{d^2\theta}{dt^2}+D_\theta\frac{d\theta}{dt}+K_\theta\theta=0
$$
和我们分析的小车运动的特征方程基本一致。所以可以采用上述二阶线性插值的方法。只不过需要将加速度换成角加速度，速度换成角速度，位移换成角度。



### 总结

刚开始看飞控的时候，误以为，控制输出量直接由当前状态和目标状态的差值经PID运算得出。忽略了插值这一环节。插值的关键在于选策略，一阶也好，二阶也好，本质上都是一些约束条件。在这些约束条件下，通过状态差获取到插值。



### 参考

[Dynamic Response of Second Order Mechanical Systems](http://rotorlab.tamu.edu/me617/handout2a_2008.pdf)

[Second-order systems](https://ocw.mit.edu/courses/mechanical-engineering/2-003-modeling-dynamics-and-control-i-spring-2005/readings/notesinstalment2.pdf)














